<?php
/*
R�sum�:
Commentaire:
version:1.1
Auteur: Ibrahima DIOP,EL hadji mamadou korka
Date de modification:07/04/2016; 04-05-2018
*/
session_start();
if($_SESSION['iduser']){

require('connection.php');

require('declarationVariables.php');

/**********************/
$designation         =@$_POST["designation"];
//var_dump($designation);
$prix                =@$_POST["prix"];
$prixSF              =@$_POST["prixSF"];
//var_dump($prix);

$idDesignation       =@$_POST["idDesignation"];
$idcategorie         =@$_POST["idcategorie"];
$classe              =@$_POST["classe"];
//var_dump($classe);
$desig               =@$_POST["desig"];
$uniteStock          =@$_POST["uniteStock"];
$prixService         =@$_POST["prixService"];
$montantFrais        =@$_POST["montantFrais"];
$nbArticleUniteStock =@$_POST["nbArticleUniteStock"];
$seuil 				 =@$_POST["seuil"];
$prixUnitaire        =@$_POST["prix"];
$prixuniteStock      =@$_POST["prixuniteStock"];
$codeBarreDesignation =@$_POST["codeBarreDesignation"];
$codeBarreuniteStock =@$_POST["codeBarreuniteStock"];

$categorie2          =@$_POST["categorie2"];
$categorie1          =@$_POST["categorie1"];


$modifier            =@$_POST["modifier"];
$supprimer           =@$_POST["supprimer"];
$annuler             =@$_POST["annuler"];
/***************/
$idDesignation1      =@$_POST["idDesignation"];



/*
echo $nomtableDesignation ;
echo $designation ;
echo $prix;
echo $uniteStock;
echo $prixuniteStock;
echo $nbArticleUniteStock;
*/
/**********************/
if(!$annuler){
if(!$modifier and !$supprimer){
  if($designation){
        $sql11="SELECT * FROM `". $nomtableDesignation."` where designation='".$designation."'";
		$res11=mysql_query($sql11);
		if(!mysql_num_rows($res11)){
             if($classe==0){
			 if ($codeBarreDesignation && $codeBarreuniteStock)
			  $sql="insert into `".$nomtableDesignation."` (designation,classe,prix,uniteStock,prixuniteStock,nbreArticleUniteStock,seuil,codeBarreDesignation,codeBarreuniteStock,categorie)
         values ('".strtoupper($designation)."',0,".$prix.",'".strtoupper($uniteStock)."',".$prixuniteStock.",".$nbArticleUniteStock.",".$seuil.",'".$codeBarreDesignation."','".$codeBarreuniteStock."','".strtoupper($categorie2)."')";
		     else if (!$codeBarreDesignation)
$sql="insert into `".$nomtableDesignation."`     (designation,classe,prix,uniteStock,prixuniteStock,nbreArticleUniteStock,seuil,codeBarreuniteStock,categorie)
values ('".strtoupper($designation)."',0,".$prix.",'".strtoupper($uniteStock)."',".$prixuniteStock.",".$nbArticleUniteStock.",".$seuil.",'".$codeBarreuniteStock."','".strtoupper($categorie2)."')";
			       else if (!$codeBarreuniteStock)

$sql="insert into `".$nomtableDesignation."`     (designation,classe,prix,uniteStock,prixuniteStock,nbreArticleUniteStock,seuil,codeBarreDesignation,categorie)
values ('".strtoupper($designation)."',0,".$prix.",'".strtoupper($uniteStock)."',".$prixuniteStock.",".$nbArticleUniteStock.",".$seuil.",'".$codeBarreDesignation."','".strtoupper($categorie2)."')";
					  else
			 $sql="insert into `".$nomtableDesignation."` (designation,classe,prix,uniteStock,seuil,prixuniteStock,nbreArticleUniteStock,categorie)
         values ('".strtoupper($designation)."',0,".$prix.",'".strtoupper($uniteStock)."',".$prixuniteStock.",".$seuil.",".$nbArticleUniteStock.",'".strtoupper($categorie2)."')";


        //var_dump($sql);


        $res=@mysql_query($sql) or die ("insertion impossible Produit".mysql_error());
			}else if($classe==1){
			  $sql="insert into `".$nomtableDesignation."` (designation,classe,prix) values('".$designation."',1,".$prixSF.")";
        //var_dump($sql);


			  $res=@mysql_query($sql) or die ("insertion impossible Service".mysql_error());
			}else if($classe==2){
			  $sql="insert into `".$nomtableDesignation."` (designation,classe,prix) values('".$designation."',2,".$prixSF.")";
        //var_dump($sql);

			  $res=@mysql_query($sql) or die ("insertion impossible Frais".mysql_error());
			}
		}
  }else if($categorie1) {
  		$sql11="SELECT * FROM `". $nomtableCategorie."` where nomcategorie='".$categorie1."'";
		$res11=mysql_query($sql11);
		if(!mysql_num_rows($res11)){
				$sql="insert into `".$nomtableCategorie."` (nomcategorie) values ('".$categorie1."')";
       			$res=@mysql_query($sql) or die ("insertion categorie 1 impossible".mysql_error());
		  }else{
		echo'<!DOCTYPE html>';
		echo'<html>';
		echo'<head>';
		echo'<script type="text/javascript" src="alertCategorie.js"></script>';
		echo'<script language="JavaScript">document.location="insertionProduit.php"</script>';
		echo'</head>';
		echo'</html>';
		}

	}
}
elseif($modifier){ //if $modifier

	  if($classe==0){
       $sql="update `".$nomtableDesignation."` set designation='".$designation."',categorie='".$categorie2."',classe=0,uniteStock='".$uniteStock."',nbreArticleUniteStock=".$nbArticleUniteStock.",seuil=".$seuil.",prix=".$prixUnitaire.",prixuniteStock=".$prixuniteStock.",codeBarreDesignation='".$codeBarreDesignation."',codeBarreuniteStock='".$codeBarreuniteStock."' where idDesignation=".$idDesignation;
       $res=@mysql_query($sql)or die ("modification impossible1 ".mysql_error());
		}else{
			 $sql="update `".$nomtableDesignation."` set designation='".$designation."',prix='".$prix."',classe='".$classe."' where idDesignation=".$idDesignation;
       $res=@mysql_query($sql)or die ("modification impossible 2".mysql_error());
			 }
}
else if ($supprimer) {
  $sql="DELETE FROM `".$nomtableDesignation."` WHERE idDesignation=".$idDesignation1;
  $res=@mysql_query($sql) or die ("suppression impossible designa     ".mysql_error());
}



/**************** DECLARATION DES ENTETES *************/
?>

<?php require('entetehtml.php'); ?>

<body onLoad="process()">
<?php
/**************** MENU HORIZONTAL *************/

  require('header.php');

/**************** Ajouter une catégorie *************/

/**************** *************  *************/
?>

    <div class="col-sm-3">
       <!-- <button type="button" class="btn btn-primary btn-success" id="AjoutDesignation">Ajouter une désignation</button> -->
        <button type="button" class="btn btn-primary btn-success" data-toggle="modal" data-target="#categorieModal" id="AjoutDesignation">Ajouter une catégorie</button>
    </div>



    <div id="categorieModal" class="modal fade " role="dialog">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                        <h4 class="modal-title">Ajout d'une Catégorie</h4>
                    </div>
                    <div class="modal-body">
                       <form role="form" class=" formulaire2" name="formulaire2" method="post" action="insertionProduit.php">
                             <input type="hidden" class="inputbasic" id="classe" name="classe" value="0" >
                            CATEGORIE<input type="text" class="inputbasic" placeholder="Entrez le nom de la catégorie" id="categorie1" name="categorie1" size="35" value="" />

                           <div class="modal-footer row">
                            <div class="col-sm-3 "><input type="submit" class="boutonbasic" name="inserer" value="ENVOYER  >>"></div>
                            <div class="col-sm-1"><input type="submit" class="boutonbasic" name="annuler" value="<<  ANNULER" /></div>
                           </div>
                        </form>
                    </div>
                </div>
            </div>
    </div>


<?php
/**************** Ajouter une catégorie  - - FIN *************/

/**************** *************  *************/
?>


</div>
<br><br>

<?php
/**************** FENETRE NODAL ASSOCIEE AU BOUTTON ModifierDesignation *************/



/**************** TABLEAU CONTENANT LA LISTE DES PRODUITS *************/

echo'<div class="container">
<ul class="nav nav-tabs">';
echo'<li class="active"><a data-toggle="tab" href="#PRODUIT">LISTE DES CATEGORIES DE PRODUITS</a></li>';
/*echo'<li><a data-toggle="tab" href="#SERVICE">LISTE DES CATEGORIES DE SERVICES</a></li>';
echo'<li><a data-toggle="tab" href="#FRAIS">LISTE DES CATEGORIES DE FRAIS</a></li>';*/
echo'</ul><div class="tab-content">';

$sql="select * from `".$nomtableCategorie."` order by idcategorie desc";
$res=mysql_query($sql);

echo'<div id="PRODUIT" class="tab-pane fade in active">';
echo'<div class="table-responsive"><table id="exemple" class="display" class="tableau3" align="left" border="1"><thead>'.
'<tr>
     <th>CATEGORIE</th>
     <th>OPERATIONS</th>
</tr>
</thead>
<tfoot>
<tr><th>CATEGORIE</th>
    <th>OPERATIONS</th>
</tr>
</tfoot>
<tbody>';

if(mysql_num_rows($res)){
	while($tab=mysql_fetch_array($res)){
	
		echo'<tr><td>'.$tab["nomcategorie"].'</td>
		<td>
		  <a>
			<img src="images/edit.png" align="middle" alt="modifier" id="" data-toggle="modal" data-target="#imgmodifier'.$tab["idcategorie"].'" /></a>&nbsp;&nbsp;
		  <a>
			<img src="images/drop.png" align="middle" alt="supprimer"  data-toggle="modal" data-target="#imgsup'.$tab["idcategorie"].'" />
		  </a>'.
		 
		'<div id="imgsup'.$tab["idcategorie"].'" class="modal fade" role="dialog">
				<div class="modal-dialog">
				   <div class="modal-content">
					   <div class="modal-header">
							<button type="button" class="close" data-dismiss="modal">&times;</button>
							<h4 class="modal-title">Confirmation Suppression Categorie</h4>
						</div>
						<div class="modal-body" style="padding:40px 50px;">

						  <table align="center" border="0">
                            <form role="form" class="" id="form" name="formulaire2" method="post" action="insertionCategorie.php">

                                <div class="form-group">
                                  <tr class="div-categorie"><td><label for="categorie">CATEGORIE </label></td></tr>
                                  <tr class="div-categorie"><td><input type="text" class="form-control" name="categorie" id="categorie" value="'.$tab["categorie"].'" disabled=""/></td></tr>
                                  <tr class="div-categorie"><td><div class="help-block label label-danger" id="helpCategorie"></div></td></tr>
                                </div>

                                
                                <tr><td align="center">
                                  <br/><br/>
                                  <input type="submit" class="boutonbasic" name="suppression" value=" SUPPRIMER >>" />
                                  <input type="submit" class="boutonbasic" name="annule" value="<<  ANNULER" />
								  <input type="hidden" name="idcategorie" value="'.$tab["idcategorie"].'"/>
									<input type="hidden" name="supprimer" value="1" />
                                    </td>
                                </tr>
                              </form>
                       </table>
					   
						</div>
				   </div>
				</div>
		</div>'.
		
		
		
		'<div id="imgmodifier'.$tab["idcategorie"].'"  class="modal fade " role="dialog">

			<div class="modal-dialog">
					<div class="modal-content">
						<div class="modal-header">
							<button type="button" class="close" data-dismiss="modal">&times;</button>
							<h4 class="modal-title">Modifier Catégorie</h4>
						</div>
						<div class="modal-body" style="padding:40px 50px;">
							
							
							
							<table align="center" border="0">
                            <form role="form" class="" id="form" name="formulaire2" method="post" action="insertionCategorie.php">

                                <div class="form-group">
                                  <tr class="div-categorie"><td><label for="reference">CATEGORIE </label></td></tr>
                                  <tr class="div-categorie"><td><input type="text" class="form-control" name="categorie" id="categorie" value="'.$tab["categorie"].'" /></td></tr>
                                  <tr class="div-categorie"><td><div class="help-block label label-danger" id="helpCategorie"></div></td></tr>
                                </div>                             


                                <tr><td align="center">
                                  <br/><br/>
                                  <input type="submit" class="boutonbasic"  name="btnModifier" value="MODIFIER  >>"/>
                                  <input type="submit" class="boutonbasic" name="annule" value="<<  ANNULER" />
								  <input type="hidden" name="idDesignation" value="'.$tab["idcategorie"].'"/>
								 <input type="hidden" name="modifier" value="1"/>
                                    </td>
                                </tr>
                              </form>
                       </table>
						
						</div>
					</div>
				</div>
		
				
		</div> ';?>
		<?php
		echo'</td></tr>';
		}
	}
}

		
echo'</tbody></table><br /></div></div>';


echo'</section>'.
'<script>$(document).ready(function(){$("#imgmodifier").click(function(){$("#ModifierDesignationModal").modal();});});</script>'.
'<script>$(document).ready(function(){$("#imgsup").click(function(){$("#supprimerDesignationModal").modal();});});</script>'.
'</div></div></body></html>

';
}
else{
echo'<!DOCTYPE html>';
echo'<html>';
echo'<head>';
echo'<script language="JavaScript">document.location="insertionProduit.php"</script>';
echo'</head>';
echo'</html>';
}
}
else{
echo'<!DOCTYPE html>';
echo'<html>';
echo'<head>';
echo'<script language="JavaScript">document.location="../index.php"</script>';
echo'</head>';
echo'</html>';
}
?>
